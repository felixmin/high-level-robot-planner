# LRZ H100 cluster profile with Enroot container support
#
# Usage:
#   python scripts/2_train_laq.py -m hydra/launcher=lrz_h100 experiment=laq_full
#
# Override resources:
#   python scripts/2_train_laq.py -m hydra/launcher=lrz_h100 hydra.launcher.timeout_min=60

defaults:
  - slurm

# H100 partition settings
partition: mcml-hgx-h100-94x4
cpus_per_task: 18
gpus_per_node: 1  # Single GPU by default, override for multi-GPU
mem_gb: 128
timeout_min: 1440  # 24 hours

# Use wrapper script as Python interpreter (launches inside Enroot container)
# The wrapper script handles container setup and path mirroring
python: "${hydra.runtime.cwd}/scripts/enroot_wrapper.sh"

# Environment setup (runs before Python command on compute node)
setup:
  - "chmod +x ${hydra.runtime.cwd}/scripts/enroot_wrapper.sh"
  - "export NCCL_SOCKET_IFNAME=ib0"
  - "export NCCL_DEBUG=WARN"
