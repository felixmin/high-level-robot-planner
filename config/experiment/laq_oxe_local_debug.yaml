# @package _global_

# Minimal local OXE run (RAM-safe):
# - no shuffle buffers
# - no prefetching
# - no tf.data AUTOTUNE
# - tiny splits + tiny batch size

defaults:
  - /model@model: laq
  - /data@data: laq_oxe_all
  - /training@training: laq_optimizer
  - /cluster@cluster: local_dev

experiment:
  name: laq_oxe_local
  description: "Minimal local OXE run (no shuffle/prefetch/autotune)"

model:
  image_size: 256
  patch_size: 16
  dim: 256
  heads: 4
  dim_head: 32
  spatial_depth: 2
  temporal_depth: 2
  quant_dim: 16

data:
  dataset:
    oxe:
      datasets:
        - name: language_table
          train_split: "train[:200]"
          val_split: "train[200:220]"
          pair_offset_steps: 10
          weight: 0.1
          approx_num_pairs: 1000000
        - name: bridge
          train_split: "train[:200]"
          val_split: "train[200:220]"
          pair_offset_steps: 5
          weight: proportionate
          approx_num_pairs: 250000
        - name: rt1
          train_split: "train[:200]"
          val_split: "train[200:220]"
          pair_offset_steps: 3
          weight: proportionate
          approx_num_pairs: 250000
        - name: robonet
          train_split: "train[:200]"
          val_split: "train[200:220]"
          pair_offset_steps: 10
          weight: proportionate
          approx_num_pairs: 250000

  preprocess:
    return_metadata: false

  loader:
    batch_size: 24
    num_workers: 0

  adapter:
    tf:
      train:
        episode_queue_shuffle_buffer: 0
        intra_episode_sample_shuffle_buffer: 0
        global_stream_shuffle_buffer: 0
      val:
        episode_queue_shuffle_buffer: 0
        intra_episode_sample_shuffle_buffer: 0
        global_stream_shuffle_buffer: 0
      prefetch:
        episode_queue_buffer: 0
        final_stream_buffer: 64
        per_dataset_stream_buffer: 0
      tfds_read:
        cycle_length: 32
      pipeline:
        episode_concurrency: 32
        transform_parallelism: 32
        interleave_parallelism: 32
      mixing:
        mix_block_length: 1
        parallelism_mode: divide
        strategy: sample
        per_dataset_private_threadpool_size: 0
      iterator:
        persistent: true
      sampling:
        samples_per_episode: 0
        seed: 0

training:
  epochs: 1
  max_steps: 5
  enable_progress_bar: false
  enable_model_summary: false
  scheduler:
    type: none
  profiler:
    enabled: true
    type: simple
    filename: fit-profile
  throughput:
    enabled: false
  dataset_usage_logger:
    enabled: false
  validation:
    check_interval: 1
    limit_batches: 0.0
    max_cached_samples: 0
    num_fixed_samples: 0
    num_random_samples: 0
    buckets: null
    strategies: null

logging:
  level: INFO
  use_wandb: false
